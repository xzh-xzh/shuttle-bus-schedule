# 🚀 接驳车查询应用 - 部署指南

## 📋 部署概览

本指南将帮助您在不同环境中部署接驳车查询应用的各个版本。

## 🌐 Web版本部署

### 静态网站托管

#### Vercel部署 (推荐)
```bash
# 1. 安装Vercel CLI
npm i -g vercel

# 2. 构建项目
npm run build

# 3. 部署
vercel --prod
```

#### Netlify部署
```bash
# 1. 构建项目
npm run build

# 2. 安装Netlify CLI
npm i -g netlify-cli

# 3. 部署
netlify deploy --prod --dir=dist
```

#### GitHub Pages部署
```bash
# 1. 安装gh-pages
npm install --save-dev gh-pages

# 2. 在package.json中添加脚本
"deploy": "gh-pages -d dist"

# 3. 构建并部署
npm run build
npm run deploy
```

### 自建服务器部署

#### Nginx配置
```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /var/www/shuttle-query/dist;
    index index.html;

    # SPA路由支持
    location / {
        try_files $uri $uri/ /index.html;
    }

    # 静态资源缓存
    location /assets/ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # Gzip压缩
    gzip on;
    gzip_types text/css application/javascript application/json;
}
```

#### Apache配置
```apache
<VirtualHost *:80>
    ServerName your-domain.com
    DocumentRoot /var/www/shuttle-query/dist
    
    # SPA路由支持
    <Directory "/var/www/shuttle-query/dist">
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>
</VirtualHost>
```

## 💻 Tauri桌面版部署

### Windows部署

#### 单文件分发
```bash
# 1. 构建应用
npm run build-tauri

# 2. 获取可执行文件
# 文件位置: src-tauri/target/release/接驳车实时查询-Tauri.exe
```

#### 安装包制作
```bash
# 1. 安装NSIS (可选)
# 下载: https://nsis.sourceforge.io/

# 2. 修改tauri.conf.json
{
  "bundle": {
    "targets": ["nsis", "msi"]
  }
}

# 3. 构建安装包
npm run build-tauri
```

#### 企业内部分发
1. **网络共享**: 将exe文件放在共享文件夹
2. **内部下载站**: 搭建简单的文件服务器
3. **邮件分发**: 直接发送exe文件（注意大小限制）

### macOS部署 (如需要)
```bash
# 1. 在macOS系统上构建
npm run build-tauri

# 2. 代码签名 (可选)
codesign --force --deep --sign "Developer ID" app.app

# 3. 公证 (App Store外分发)
xcrun notarytool submit app.dmg --keychain-profile "notarytool-profile"
```

### Linux部署 (如需要)
```bash
# 1. 构建AppImage
npm run build-tauri

# 2. 创建.desktop文件
[Desktop Entry]
Name=接驳车查询
Exec=/path/to/app
Icon=/path/to/icon
Type=Application
Categories=Utility;
```

## 📱 Android版本部署

### Google Play Store发布

#### 准备工作
```bash
# 1. 生成签名密钥
keytool -genkey -v -keystore shuttle-query.keystore -alias shuttle-query -keyalg RSA -keysize 2048 -validity 10000

# 2. 配置签名
# 在android/app/build.gradle中添加签名配置
```

#### 构建发布版本
```bash
# 1. 构建生产版本
npm run build-android

# 2. 生成签名APK
cd android
./gradlew assembleRelease

# 3. 生成AAB包 (推荐)
./gradlew bundleRelease
```

### 企业内部分发

#### APK直接分发
```bash
# 1. 构建APK
npm run build-android

# 2. 分发方式
# - 内部文件服务器
# - 邮件附件
# - 即时通讯工具
# - 二维码下载
```

#### 企业应用商店
- **华为应用市场企业版**
- **小米应用商店企业版**
- **第三方MDM系统**

## 🔧 CI/CD自动化部署

### GitHub Actions配置

#### Web版本自动部署
```yaml
# .github/workflows/deploy-web.yml
name: Deploy Web App

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Build
      run: npm run build
      
    - name: Deploy to Vercel
      uses: amondnet/vercel-action@v20
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-org-id: ${{ secrets.ORG_ID }}
        vercel-project-id: ${{ secrets.PROJECT_ID }}
        working-directory: ./
```

#### Tauri自动构建
```yaml
# .github/workflows/build-tauri.yml
name: Build Tauri App

on:
  push:
    tags: [ 'v*' ]

jobs:
  build:
    strategy:
      matrix:
        platform: [windows-latest, macos-latest, ubuntu-latest]
    
    runs-on: ${{ matrix.platform }}
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: Setup Rust
      uses: dtolnay/rust-toolchain@stable
      
    - name: Install dependencies
      run: npm ci
      
    - name: Build Tauri app
      run: npm run build-tauri
      
    - name: Upload artifacts
      uses: actions/upload-artifact@v3
      with:
        name: tauri-app-${{ matrix.platform }}
        path: src-tauri/target/release/bundle/
```

## 🔒 安全考虑

### Web版本安全
- **HTTPS部署**: 确保使用SSL证书
- **CSP配置**: 设置内容安全策略
- **CORS配置**: 正确配置跨域请求

### 桌面版安全
- **代码签名**: 避免安全警告
- **权限最小化**: 只请求必要权限
- **更新机制**: 实现安全的自动更新

### Android版安全
- **应用签名**: 使用正确的签名密钥
- **权限声明**: 明确权限用途
- **混淆保护**: 启用代码混淆

## 📊 监控和分析

### Web版本监控
```javascript
// 添加Google Analytics
gtag('config', 'GA_MEASUREMENT_ID');

// 添加错误监控
window.addEventListener('error', (event) => {
  // 发送错误报告
});
```

### 应用性能监控
- **Sentry**: 错误追踪和性能监控
- **LogRocket**: 用户会话录制
- **Hotjar**: 用户行为分析

## 🚀 部署最佳实践

### 版本管理
1. **语义化版本**: 使用semver规范
2. **变更日志**: 维护CHANGELOG.md
3. **标签发布**: 使用Git标签标记版本

### 测试策略
1. **单元测试**: 核心逻辑测试
2. **集成测试**: 端到端测试
3. **设备测试**: 多设备兼容性测试

### 回滚策略
1. **版本备份**: 保留历史版本
2. **快速回滚**: 准备回滚脚本
3. **监控告警**: 及时发现问题

## 📞 技术支持

### 常见问题
- **部署失败**: 检查环境配置和依赖
- **权限问题**: 确认文件和目录权限
- **网络问题**: 检查防火墙和代理设置

### 联系方式
- **技术文档**: 查看项目README.md
- **问题反馈**: 提交GitHub Issue
- **紧急支持**: 联系开发团队

---

🎯 **部署成功！** 您的接驳车查询应用现在可以在多个平台上为用户提供服务了！